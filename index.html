<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TopDownSpace</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #000;
            overflow: hidden;
        }
        canvas {
            border: 1px solid #fff;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Player properties
        const players = [
            { x: 100, y: 300, angle: 0, speed: 0, color: '#f00', keys: { up: 'w', down: 's', left: 'a', right: 'd' }, bullets: [] }, // WASD
            { x: 300, y: 300, angle: 0, speed: 0, color: '#0f0', keys: { up: 'ArrowUp', down: 'ArrowDown', left: 'ArrowLeft', right: 'ArrowRight' }, bullets: [] }, // Arrows
            { x: 500, y: 300, angle: 0, speed: 0, color: '#00f', keys: { up: 'i', down: 'k', left: 'j', right: 'l' }, bullets: [] } // IJKL
        ];

        // Asteroids and particles
        const asteroids = [];
        const particles = [];
        const asteroidCount = 5;

        // Keyboard state
        const keys = {};

        // Event listeners for keyboard
        window.addEventListener('keydown', (e) => keys[e.key] = true);
        window.addEventListener('keyup', (e) => keys[e.key] = false);

        // Spawn asteroids
        function spawnAsteroids() {
            while (asteroids.length < asteroidCount) {
                asteroids.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: 20 + Math.random() * 20,
                    dx: (Math.random() - 0.5) * 2,
                    dy: (Math.random() - 0.5) * 2
                });
            }
        }

        // Draw triangle (player ship)
        function drawShip(player) {
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.angle);
            ctx.beginPath();
            ctx.moveTo(15, 0);
            ctx.lineTo(-10, 10);
            ctx.lineTo(-10, -10);
            ctx.closePath();
            ctx.fillStyle = player.color;
            ctx.fill();
            ctx.restore();
        }

        // Update player position and shoot
        function updatePlayer(player) {
            const { up, down, left, right } = player.keys;
            if (keys[up]) player.speed = 3;
            else if (keys[down]) player.speed = -2;
            else player.speed *= 0.9; // Friction

            if (keys[left]) player.angle -= 0.1;
            if (keys[right]) player.angle += 0.1;

            player.x += Math.cos(player.angle) * player.speed;
            player.y += Math.sin(player.angle) * player.speed;

            // Keep player in bounds
            player.x = Math.max(15, Math.min(canvas.width - 15, player.x));
            player.y = Math.max(15, Math.min(canvas.height - 15, player.y));

            // Auto-shoot every 20 frames
            if (Math.random() < 0.05) {
                player.bullets.push({
                    x: player.x + Math.cos(player.angle) * 15,
                    y: player.y + Math.sin(player.angle) * 15,
                    dx: Math.cos(player.angle) * 5,
                    dy: Math.sin(player.angle) * 5
                });
            }

            // Update bullets
            player.bullets = player.bullets.filter(b => {
                b.x += b.dx;
                b.y += b.dy;
                return b.x > 0 && b.x < canvas.width && b.y > 0 && b.y < canvas.height;
            });
        }

        // Draw and update bullets
        function drawBullets(player) {
            ctx.fillStyle = player.color;
            player.bullets.forEach(b => {
                ctx.beginPath();
                ctx.arc(b.x, b.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Update and draw asteroids
        function updateAsteroids() {
            asteroids.forEach(a => {
                a.x += a.dx;
                a.y += a.dy;

                // Bounce off walls
                if (a.x - a.radius < 0 || a.x + a.radius > canvas.width) a.dx *= -1;
                if (a.y - a.radius < 0 || a.y + a.radius > canvas.height) a.dy *= -1;

                ctx.beginPath();
                ctx.arc(a.x, a.y, a.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#888';
                ctx.fill();
            });
        }

        // Particle effects (for coolness)
        function updateParticles() {
            if (Math.random() < 0.3) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: 1 + Math.random() * 2,
                    life: 30
                });
            }
            particles.forEach((p, i) => {
                p.life--;
                if (p.life <= 0) particles.splice(i, 1);
                else {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${p.life / 30})`;
                    ctx.fill();
                }
            });
        }

        // Collision detection
        function checkCollisions() {
            players.forEach(p => {
                asteroids.forEach(a => {
                    const dx = p.x - a.x;
                    const dy = p.y - a.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < a.radius + 15) {
                        p.x = 100 + Math.random() * 400; // Respawn
                        p.y = 300;
                    }
                });
            });
        }

        // Game loop
        function gameLoop() {
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            spawnAsteroids();
            players.forEach(p => {
                updatePlayer(p);
                drawShip(p);
                drawBullets(p);
            });
            updateAsteroids();
            updateParticles();
            checkCollisions();

            requestAnimationFrame(gameLoop);
        }

        // Start the game
        gameLoop();
    </script>
</body>
</html>
